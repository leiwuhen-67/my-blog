---
title: React之key的使用
date: 2024-03-11 17:00:53
permalink: /pages/a9fc09/
categories:
  - React
tags:
  - 
---
我们在进行列表渲染的时候，经常会需要给数组中的每一项指定一个key，否则控制台会有警告，类似这种警告，Warning: Each child in a list should have a unique “key” prop.

那么问题来了，为什么需要指定key？如何指定key？key的作用是啥？<br>
首先，key是虚拟Dom对象的标识，在更新显示时key有着十分重要的作用，当状态中的数据发生变化时，React会根据新数据生成新的虚拟Dom，随后React进行新的虚拟Dom与旧的虚拟Dom进行diff比较，规则如下：
* 旧虚拟Dom中找到了与新虚拟Dom相同的key：<br>
  《1》、若虚拟Dom中内容没变，直接使用之前的真实Dom<br>
  《2》、若虚拟Dom中内容变了，则生成新的真实Dom，随后替换掉页面之前的真实Dom
* 旧虚拟Dom中未找到与新的虚拟Dom相同的key：
  根据数据创建新的真实Dom，随后渲染到页面。

如何设定key？<br>
1、最好使用每条数据的唯一标识作为key，如id、手机号、身份证号、学号等唯一值。<br>
2、如果只是简单的展示数据，则可以使用index

key需要满足的条件：
* key 值在兄弟节点之间必须是唯一的。 不过不要求全局唯一，在不同的数组中可以使用相同的 key。
* key 值不能改变，否则就失去了使用 key 的意义！所以千万不要在渲染时动态地生成 key。

在项目中我们经常会使用index作为key，这除了有效率问题外，在多数情况下都不会引发界面效果问题，然而，在有些时候，key确实会引发问题：<br>
比如，在对数据进行逆序添加、逆序删除等破坏顺序的操作时，会产生没有必要的真实Dom更新，虽然界面上不会有啥问题，但是会有效率问题，在数据量少的时候不会有什么影响，但是如果数据量非常大的时候，影响就很大了。<br><br>
再比如，页面结构中包含了输入类的Dom，那么则会产生错误的Dom更新，导致界面出现问题