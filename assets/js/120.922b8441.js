(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{468:function(e,s,a){"use strict";a.r(s);var n=a(4),r=Object(n.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("在按照 react native 官方文档打包成 apk 文件后，感觉文件有点大。因此想优化一番。")]),e._v(" "),s("p",[e._v("主要是做了以下优化：")]),e._v(" "),s("h2",{attrs:{id:"一、启动代码混淆"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、启动代码混淆"}},[e._v("#")]),e._v(" 一、启动代码混淆")]),e._v(" "),s("p",[e._v("在 android/app/build.gradle 中配置：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('android {\n    buildTypes {\n        release {\n            minifyEnabled true   // 启用代码压缩\n            shrinkResources true // 移除未使用的资源\n            signingConfig signingConfigs.debug\n            minifyEnabled enableProguardInReleaseBuilds\n            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"\n            signingConfig signingConfigs.release\n        }\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("h2",{attrs:{id:"二、拆分cpu架构-abi分包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、拆分cpu架构-abi分包"}},[e._v("#")]),e._v(" 二、拆分 cpu 架构（ABI 分包）")]),e._v(" "),s("p",[e._v("所谓 ABI 分包是指将传统的构建一个 APK 文件的过程，改为根据不同的硬件架构（如 ARM、x86 等）来构建多个 APK 文件。这种分包处理可以优化应用的兼容性和性能，确保应用能够在不同的硬件上正常运行。"),s("br"),e._v("\n现代设备大多支持 arm64-v8a，可仅保留主流架构：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('def enableSeparateBuildPerCPUArchitecture = true\n\nandroid {\n    splits {\n        abi {\n            enable true\n            reset()\n            include "arm64-v8a", "x86", "x86_64" // 按需选择\n            universalApk true  // 设置为true将额外生成一个适用不同CPU架构的通用apk\n        }\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br")])]),s("h2",{attrs:{id:"三、启动hermes引擎"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、启动hermes引擎"}},[e._v("#")]),e._v(" 三、启动 Hermes 引擎")]),e._v(" "),s("p",[e._v("在 android/app/build.gradle 中启用 Hermes：")]),e._v(" "),s("p",[e._v("1、打开 android/app/build.gradle 文件。"),s("br"),e._v("\n2、找到 project.ext.react 配置块，将 enableHermes 设置为 true：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("project.ext.react = [\n    enableHermes: true,  // 改为 true\n    // 其他配置...\n]\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("如果找不到该配置块，直接手动添加以下内容：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("project.ext.react = [\n    enableHermes: true,  // 启用 Hermes\n    bundleInDebug: false,\n    bundleInRelease: true,\n    devDisabledInRelease: true\n]\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("提示")]),e._v(" "),s("p",[e._v("enableHermes: 布尔值，表示是否启用 Hermes 引擎，这是一个用于提升性能的 JS 引擎，适用于 Android。设为 true 会使用 Hermes 替代 JSC。启用后首次构建时间会变长。"),s("br"),e._v("\nbundleInDebug: 布尔值，表示是否在 debug 构建中打包 JS Bundle。如果为 true，即使是 Debug 版本也会生成 JS Bundle（一般用于某些调试场景，不建议打开）。"),s("br"),e._v("\nbundleInRelease: 布尔值，表示是否在 release 构建中打包 JS Bundle。设为 true 是发布应用时必须的，会将 JS Bundle 编译打包进 APK。"),s("br"),e._v("\ndevDisabledInRelease: 布尔值，设为 true 会关闭 Release 构建中的开发功能（比如开发者菜单、远程调试），保证发布版本更轻量、安全。")])]),e._v(" "),s("h2",{attrs:{id:"四、启用proguard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、启用proguard"}},[e._v("#")]),e._v(" 四、启用 ProGuard")]),e._v(" "),s("p",[e._v("Proguard 是一个 Java 字节码混淆压缩工具，它可以移除掉 React Native Java（和它的依赖库中）中没有被使用到的部分，最终有效的减少 APK 的大小。"),s("br"),e._v("\n重要：启用 Proguard 之后，必须再次全面地测试应用"),s("br"),e._v("\n要启用 Proguard，需要修改 android/app/build.gradle 文件：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("def enableProguardInReleaseBuilds = true\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("在 android/app/proguard-rules.pro 文件中添加：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("-keep class com.facebook.hermes.unicode.** { *; }\n-keep class com.facebook.jni.** { *; }\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("至此，就可进入 android 文件夹下执行打包操作了")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ cd android\n$ ./gradlew assembleRelease\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("按照上述操作步骤优化后，打包后会有以下几种结果："),s("br"),e._v(" "),s("img",{attrs:{src:"https://s3.bmp.ovh/imgs/2025/05/23/f76eafb5377993a1.png",alt:""}}),s("br"),e._v("\nps: 生成的 APK 文件位于 android/app/build/outputs/apk/release/app-release.apk，它已经可以用来发布了。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("提示")]),e._v(" "),s("p",[e._v("译注：cd android 表示进入 android 目录（如果你已经在 android 目录中了那就不用输入了）。./gradlew assembleRelease 在 macOS、Linux 或是 windows 的 PowerShell 环境中表示执行当前目录下的名为 gradlew 的脚本文件，且其运行参数为 assembleRelease，注意这个./ 不可省略；而在 windows 的传统 CMD 命令行下则需要去掉./。")])])])}),[],!1,null,null,null);s.default=r.exports}}]);